<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title>Backbone-Associations - Specification</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Support associations/relations in Backbone.js">
    <meta name="author" content="Dhruva Ray">
    <meta name="keywords"
          content="Backbone, relational, associations, association, nested, associated, model, cyclic graph, qualified event paths, relational, relations">


    <link href="./assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
            position: relative;
        }

        section {
            padding-top: 40px;
        }

        section > .page-header,
        section > .lead {
            color: #5a5a5a;
        }

        section > ul li {
            margin-bottom: 5px;
        }

    </style>
    <link href="./assets/css/bootstrap-responsive.css" rel="stylesheet">
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-41921363-1', 'dhruvaray.github.io');
        ga('send', 'pageview');

    </script>

</head>

<body data-target=".bs-docs-sidebar" data-spy="scroll">

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="index.html">Backbone Associations</a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="./index.html">Home</a></li>
                    <li><a href="./getting-started.html">Get Started</a></li>
                    <li class="active"><a href="./specify-associations.html" class="active">Specify Associations</a>
                    </li>
                    <li><a href="./events.html">Events</a></li>
                    <li><a href="./tutorial.html">Tutorials</a></li>
                    <li><a href="./recipes.html">Recipes</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">

<!-- Example row of columns -->
<div class="row-fluid">
<div class="span3">
    <div class="well sidebar-nav bs-docs-sidebar affix">
        <ul class="nav nav-list bs-docs-sidenav">
            <li class="nav-header">Specify Associations</li>
            <li class="active"><a href="#sa-api">API</a></li>
            <li><a href="#sa-one">1:1</a></li>
            <li><a href="#sa-many">1:M</a></li>
            <li><a href="#sa-reverse">Reverse</a></li>
            <li><a href="#sa-map">Lookup Transformations</a></li>
            <li class="nav-header">Navigate Associations</li>
            <li><a href="#sa-getsetop">Get & Set</a></li>
            <li class="nav-header">Serialize Associations</li>
            <li><a href="#sa-sfop">Save & Fetch</a></li>
            <li class="nav-header">Next Steps</li>
            <li><a href="#sa-events">Eventing</a></li>
        </ul>
    </div>
</div>
<div class="span9">

<section id="sa-api">
    <h4>API</h4>
    <hr/>
    <div class="well well-large">

        Backbone.AssociatedModel allows for associations to be set-up between other Backbone Models and Collections.
        To achieve this, extend Backbone.AssociatedModel to specify an array of relations.

        Each association (relation) is defined by the following attributes.
        <dl class="dl-horizontal">
            <dt>relatedModel<br/>
                (required)
            </dt>
            <dd>
                <ul>
                    <li><span class="label label-info">v0.5.1+</span> A function(relation, attributes) - which returns a
                        reference to a AssociatedModel type.
                        <ul>
                            <li>relation : the specific relation object in the array of relations.</li>
                            <li>attributes : hash of new values passed in via set.</li>
                        </ul>
                        See the <a href="./recipes.html">recipes</a> for an <a href="./recipes.html#tut-pa">example</a>
                        of where this may be useful.
                    <li>A reference to a Backbone.AssociatedModel type.</li>
                    <li>A fully qualified string which can be resolved to an object type on the global scope.</li>
                    <li><span class="label label-info">v0.5.1+</span> A special value - Backbone.Self - can also be set.
                        This special value is useful in self-reference scenarios.
                    </li>
                </ul>
            </dd>
        </dl>


        <hr/>

        <dl class="dl-horizontal">
            <dt>key (required)</dt>
            <dd>A string which references an attribute name for the relatedModel.<br />This key MUST be defined in the model defaults, although can be null or empty.</dd>
        </dl>

        <hr/>

        <dl class="dl-horizontal">
            <dt>type (required)</dt>
            <dd>
                <ul>
                    <li>Backbone.One for 1:1 Associations.</li>
                    <li>Backbone.Many for 1:M Associations.</li>
                </ul>
            </dd>
        </dl>

        <hr/>

        <dl class="dl-horizontal">
            <dt>collectionType <br/>(optional)</dt>
            <dd>
                Used to determine the type of collection used for a Backbone.Many relation.
                <p><span class="label label-warning">Note</span> If collectionType attribute is specified, relatedModel
                    is ignored.</p>
                <ul>
                    <li>A reference to a Backbone.Collection type.</li>
                    <li>A fully qualified string which can be resolved to an object type on the global scope.</li>
                </ul>
            </dd>
        </dl>

        <hr/>

        <dl class="dl-horizontal">
            <dt>map (optional)</dt>
            <dd>
                Specify a transformation function to convert the value before it is assigned to the key on the
                relatedModel.
            </dd>
        </dl>

    </div>
</section>
<section id="sa-one">
    <h4>Specify 1:1 associations</h4>
    <hr/>
    <div class="well well-large">
        Use Backbone.One to specify a 1:1 relationship between two Backbone Models. The key specifies the attribute on
        the AssociatedModel which will hold the instance of relatedModel and must have a default defined.
                <pre class="prettyprint lang-js">

var Employee = Backbone.AssociatedModel.extend({
    relations: [
        {
            type: Backbone.One, //nature of the relationship
            key: 'manager', // attribute of Employee
            relatedModel: 'Employee' //AssociatedModel for attribute key
        }
    ],
    defaults: {
        age : 0,
        fname : "",
        lname : "",
        manager : null
    }
});
                </pre>
    </div>

</section>
<section id="sa-many">
    <h4>Specify 1:M associations</h4>
    <hr/>
    <div class="well well-large">
        Use Backbone.Many to specify a 1:M relationship between two Backbone Models. Otherwise, identical to specifying
        1:1 associations.
            <pre class="prettyprint lang-js">
var Location = Backbone.AssociatedModel.extend({
  defaults: {
    add1 : "",
    add2 : null,
    zip : "",
    state : ""
  }
});

var Project = Backbone.AssociatedModel.extend({
  relations: [
      {
        type: Backbone.Many,//nature of the relation
        key: 'locations', //attribute of Project
        relatedModel:Location //AssociatedModel for attribute key
      }
  ],
  defaults: {
    name : "",
    number : 0,
    locations : []
  }
});
            </pre>

        To specify 1:M associations, one can alternatively use the collectionType property. This can be useful to
        specify implementation of custom or built-in properties at the Collection level.
            <pre class="prettyprint lang-js">
var Location = Backbone.AssociatedModel.extend({
  defaults: {
    add1 : "",
    add2 : null,
    zip : "",
    state : ""
  }
});

var Locations = Backbone.Collection.extend({
    comparator: function(c){
        return c.get('number');
    },

    model: Location
});

var Project = Backbone.AssociatedModel.extend({
  relations: [
      {
        type: Backbone.Many,//nature of the relation
        key: 'locations', //attribute of Project
        collectionType: Locations //Collection to be used.
        relatedModel:Location //Optional
      }
  ],
  defaults: {
    name : "",
    number : 0,
    locations : []
  }
});
            </pre>
    </div>

</section>
<section id="sa-reverse">
    <h4>Specify Reverse Associations</h4>
    <hr/>
    <div class="well well-large">

        These are automatically inferred by Backbone-associations. You can access reverse associations via a parents
        property on the AssociationModel or Backbone Collection. Note that the parents property is an array - as there
        could be multiple parents for a given AssociatedModel or Collection. The parents property simply stores the
        references of objects pointing to it and is agnostic of the type of the object.

        <br/><span
            class="label label-info">Remember : The parents property can contain different type instances</span><br/>


                    <pre class="prettyprint">
dept1 = new Department({
    name:"R&D",
    number:"23"
});

var emp1 = new Employee({
    fname:"Tom",
    lname:"Hanks",
    age:41,
    sex:"M"
});

var emp2 = new Employee({
    fname:"Michelle",
    lname:"Pfiefer",
    age:42,
    sex:"F"
});

emp1.set({"works_for":dept1});
emp2.set({"works_for":dept1});

dept1.parents //[emp1, emp2]

myco = new Company({
   name:"Github Inc"
});

myco.set({research:dept1});

dept1.parents //[emp1, emp2, myco]
                    </pre>

        <span class="label label-warning">Prevent memory leaks</span><br/><span class="label label-info">Available in v0.5.1+</span><br/>

        Memory leaks may be inadvertently caused and parents property may have wrong values if objects are set to
        undefined (or null) directly. Call the cleanup method before setting any object to undefined to prevent this
        from happening. The example below clarifies.

<pre class="prettyprint">
//Could cause mem leaks if you set emp2 = undefined
//emp2 = undefined;
//dept1.parents.length === 3 //Should have been 2

emp2.cleanup();
emp2 = undefined;
//dept1.parents.length === 2
</pre>
    </div>

</section>
<section id="sa-map">
    <h4>Specify Transformations</h4>
    <hr/>
    <div class="well well-large">
        Use a map function to transform values before assigning them to a model attribute. Could be typically used to
        transform (master) ids to a (master) AssociatedModel references.
<pre class="prettyprint">
var MasterType = Backbone.Model.extend({
    defaults:{
        id:"-1",
        type:"",
        validations:""
    }
});

store = new Backbone.Collection([
    {id:1, type:"phone", validations:"regex to validate phone #s here"},
    {id:2, type:'email', validations:"regex to validate email formats here"}
], {model:MasterType});


var Field = Backbone.AssociatedModel.extend({
    relations:[
        {
            type:Backbone.One,
            key:'type',
            relatedModel:MasterType,
            map:function (type) {
                //a local master store holding the master data reference
                return store.findWhere({type:type});
            }
        }
    ],

    defaults:{
        type:undefined,
        data:undefined,
        name:""
    }

});

var phone = new Field({name:'Residence Phone', type:'phone' });
var email = new Field({name:'Primary Email', type:'email'});

phone.get('type').get('validations') //regex to validate phone #s
email.get('type').get('validations'), //regex to validate email
</pre>
    </div>
</section>

<section id="sa-getsetop">
    <h4>Get & set values from the object graph</h4>
    <hr/>
    <div class="well well-large">
        <h5>Retrieve values from the object graph</h5>
        Values can be retrieved by either specifying a fully qualified path or by explicitly traversing the object
        graph.
<pre class="prettyprint">
emp.get('works_for.controls[0].locations[0].zip') //94404

//or

emp.get('works_for').get('controls').at(0).get('locations').at(0).get('zip');
</pre>

        <h5>Set values in the object graph</h5>
        Values can be set by either specifying a fully qualified path or by explicitly traversing the object graph to
        that property before setting the value.

<pre class="prettyprint">
emp.set('works_for.locations[0].zip', 94403);

//or

emp.get('works_for').get('locations').at(0).set('zip',94403);
</pre>

    </div>
</section>

<section id="sa-sfop">
    <h4>Serialize and De-serialize object graphs</h4>
    <hr/>
    <div class="well well-large">
        It would not very meaningful (or speedy) for web applications to transfer object graphs in their entirety across
        the network . Most applications would save and fetch parts of the object hierarchy incrementally. Many times,
        the primary keys of the nested object may be serialized rather than the actual instance itself.
        Backbone-associations leaves these decisions to the application. The base Backbone framework (and associations)
        provides hooks to easily achieve this. A representative scenario is implemented using these hooks in this <a
            href="https://gist.github.com/jdkanani/5822296">gist</a> and corresponding <a
            href="http://jsfiddle.net/jdkanani/a33Zt/">fiddle</a>.
    </div>
</section>

<section id="sa-events">
    <h4>Eventing</h4>
    <hr/>
    <div class="well well-large">
        Once the object hierarchy instance is set up, the next step is to tune-in to any kind of changes (update, add,
        remove, destroy, sort etc) which happen in this object hierarchy. Views - for example - would like to re-render
        to reflect the new model data. This is the topic of the <a href="./events.html">eventing</a> section of the
        documentation.

    </div>
</section>

</div>

</div>


</div>

<!-- Placed at the end of the document so the pages load faster -->
<script src="http:////ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
<script src="./assets/js/bootstrap.js"></script>
<script src="./assets/js/ba.js"></script>


</body>
</html>
